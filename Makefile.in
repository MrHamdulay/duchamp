CFLAGS = -c

FFLAGS = -C -fast -O4

CC =    @CC@
CXX =   @CXX@
F77=    @F77@ $(FFLAGS)

BASE = ./src

INSTALLDIR = .

EXEC = Duchamp

PGPLOTINC = @PGPLOTINC@
PGPLOTLIB = @PGPLOTLIB@

CFITSIOINC = @CFITSIOINC@
CFITSIOLIB = @CFITSIOLIB@

WCSINC = @WCSINC@
WCSLIB = @WCSLIB@

CINC = $(PGPLOTINC) $(WCSINC) $(CFITSIOINC) -I$(BASE)

LIBS = @LDFLAGS@ $(WCSLIB) $(CFITSIOLIB) $(PGPLOTLIB) @LIBS@

ATROUSDIR = $(BASE)/ATrous
DETECTIONDIR = $(BASE)/Detection
CUBESDIR = $(BASE)/Cubes
FITSIODIR = $(BASE)/FitsIO
UTILDIR = $(BASE)/Utils
TESTDIR = ./verification

HEADS = $(BASE)/duchamp.hh\
	$(BASE)/param.hh\
	$(PIXELMAPDIR)/Voxel.hh\
	$(PIXELMAPDIR)/Scan.hh\
	$(PIXELMAPDIR)/Object2D.hh\
	$(PIXELMAPDIR)/Object3D.hh\
	$(ATROUSDIR)/atrous.hh\
	$(ATROUSDIR)/filter.hh\
	$(DETECTIONDIR)/voxel.hh\
	$(DETECTIONDIR)/detection.hh\
	$(DETECTIONDIR)/columns.hh\
	$(CUBESDIR)/cubes.hh\
	$(CUBESDIR)/plots.hh\
	$(UTILDIR)/Section.hh\
	$(UTILDIR)/Statistics.hh\
	$(UTILDIR)/utils.hh

OBJECTS = $(BASE)/mainDuchamp.o \
	$(BASE)/duchamp.o\
	$(BASE)/param.o\
	$(PIXELMAPDIR)/Voxel.o\
	$(PIXELMAPDIR)/Scan.o\
	$(PIXELMAPDIR)/Object2D.o\
	$(PIXELMAPDIR)/Object3D.o\
	$(ATROUSDIR)/filter.o\
	$(ATROUSDIR)/atrous_1d_reconstruct.o\
	$(ATROUSDIR)/atrous_2d_reconstruct.o\
	$(ATROUSDIR)/atrous_3d_reconstruct.o\
	$(ATROUSDIR)/baselineSubtract.o\
	$(ATROUSDIR)/ReconSearch.o\
	$(DETECTIONDIR)/voxel.o\
	$(DETECTIONDIR)/detection.o\
	$(DETECTIONDIR)/columns.o\
	$(DETECTIONDIR)/areClose.o\
	$(DETECTIONDIR)/growObject.o\
	$(DETECTIONDIR)/lutz_detect.o\
	$(DETECTIONDIR)/mergeIntoList.o\
	$(DETECTIONDIR)/outputDetection.o\
	$(DETECTIONDIR)/sorting.o\
	$(DETECTIONDIR)/spectrumDetect.o\
	$(CUBESDIR)/cubes.o\
	$(CUBESDIR)/cubes_extended.o\
	$(CUBESDIR)/plots.o\
	$(CUBESDIR)/baseline.o\
	$(CUBESDIR)/CubicSearch.o\
	$(CUBESDIR)/detectionIO.o\
	$(CUBESDIR)/drawMomentCutout.o\
	$(CUBESDIR)/drawBlankEdges.o\
	$(CUBESDIR)/getImage.o\
	$(CUBESDIR)/invertCube.o\
	$(CUBESDIR)/Merger.o\
	$(CUBESDIR)/outputSpectra.o\
	$(CUBESDIR)/plotting.o\
	$(CUBESDIR)/readRecon.o\
	$(CUBESDIR)/readSmooth.o\
	$(CUBESDIR)/saveImage.o\
	$(CUBESDIR)/smoothCube.o\
	$(CUBESDIR)/trimImage.o\
	$(FITSIODIR)/dataIO.o\
	$(FITSIODIR)/headerIO.o\
	$(FITSIODIR)/subsection.o\
	$(FITSIODIR)/wcsIO.o\
	$(UTILDIR)/Section.o\
	$(UTILDIR)/Statistics.o\
	$(UTILDIR)/feedback.o\
	$(UTILDIR)/Hanning.o\
	$(UTILDIR)/getStats.o\
	$(UTILDIR)/get_random_spectrum.o\
	$(UTILDIR)/linear_regression.o\
	$(UTILDIR)/pgplot_related.o\
	$(UTILDIR)/position_related.o\
	$(UTILDIR)/sort.o\
	$(UTILDIR)/wcsFunctions.o\
	$(UTILDIR)/zscale.o

duchamp : $(OBJECTS)
	$(CXX) -o $(INSTALLDIR)/$(EXEC) $(OBJECTS) $(LIBS)

createTestImage : $(TESTDIR)/createTestImage.o $(UTILDIR)/get_random_spectrum.o
	$(CXX) -o createTestImage.x\
	$(TESTDIR)/createTestImage.o $(UTILDIR)/get_random_spectrum.o\
	$(CFITSIOLIB) @LIBS@

$(OBJECTS) : $(HEADS)

.cc.o:
	$(CXX) -c $< $(CINC) -o $@

.c.o:
	$(CC) -c $< $(CINC) -o $@

clean : 
	rm -f $(BASE)/*.o $(ATROUSDIR)/*.o $(CUBESDIR)/*.o $(FITSIODIR)/*.o $(DETECTIONDIR)/*.o $(UTILDIR)/*.o 
